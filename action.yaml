name: Setup commitizen CLI
description: |
  This workflow sets up the commitizen CLI for use in your GitHub workflows.
  Unlike `commitizen-action`, this workflow only installs the CLI.
  It does not automatically bump, commit or push changes.
  This workflow, instead, gives more flexibility to the user by letting them
  use the full range of commitizen commands.

inputs:
  version:
    description: "Version of commitizen to install"
    required: false
    default: "latest"
  extra_requirements:
    description: "Install extra dependencies"
    required: false
  cache:
    description: 'Cache python setup, set to "true" to enable'
    required: false
    default: "false"

runs:
  using: "composite"
  steps:
    - id: set-vars
      shell: python
      env:
        COMMITIZEN_VERSION: ${{ inputs.version }}
        CACHE: ${{ inputs.cache }}
      run: |
        import os

        # Set commitizen version
        commitizen_version = os.environ.get("COMMITIZEN_VERSION", "").strip()
        if commitizen_version == "latest":
            set_commitizen_version = ""
        else:
            set_commitizen_version = f"=={commitizen_version}"

        # Set python cache
        cache = os.environ.get("CACHE", "")
        if cache == True or cache == "true":
            set_cache = "pip"
        else:
            set_cache = ""

        # Write outputs
        with open(os.environ["GITHUB_OUTPUT"], "a") as fh:
            fh.write(f"COMMITIZEN_VERSION={set_commitizen_version}\n")
            fh.write(f"PYTHON_CACHE={set_cache}\n")
    - uses: actions/setup-python@v6
      with:
        cache: ${{ steps.set-vars.outputs.PYTHON_CACHE }}
    - name: Install commitizen
      shell: bash
      env:
        COMMITIZEN_VERSION: ${{ steps.set-vars.outputs.COMMITIZEN_VERSION }}
        EXTRA_REQUIREMENTS: ${{ inputs.extra_requirements }}
      run: |
        pip install -U commitizen${COMMITIZEN_VERSION} ${EXTRA_REQUIREMENTS}
